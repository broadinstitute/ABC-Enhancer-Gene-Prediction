import os
import pandas as pd
import hashlib
import numpy as np
from snakemake.utils import min_version
min_version("7.0")

configfile: "config/config.yaml"
conda: "mamba"

include: "rules/utils.smk"
RESULTS_DIR = config['predictions_results_dir']
## Load biosamples and hic_hash dictionary
HIC_COLUMNS = ["HiC_dir", "HiC_type", "HiC_resolution", "HiC_gamma", "HiC_scale"]
BIOSAMPLES_CONFIG = load_biosamples_config(config)
HIC_HASHES = configure_hic_hashes(BIOSAMPLES_CONFIG)

include: "rules/macs2.smk"
include: "rules/candidate_regions.smk"
include: "rules/call_neighborhoods.smk"
include: "rules/write_powerlaw_params.smk"
include: "rules/predictions.smk"
include: "rules/qc.smk"

## overall rule to run pipeline
rule all:
	input:
		allPutative = expand(
			os.path.join(RESULTS_DIR, "{biosample}", "Predictions", "EnhancerPredictionsAllPutative.txt.gz"), biosample=BIOSAMPLES_CONFIG["biosample"]
		),
		enhPredictions = expand(
			os.path.join(RESULTS_DIR, "{biosample}", "Predictions", "EnhancerPredictions.tsv"), biosample=BIOSAMPLES_CONFIG["biosample"]
		),
		allPred = os.path.join(RESULTS_DIR,"AllPredictions.txt.gz"),
		qcPlots = expand(
			os.path.join(RESULTS_DIR, "{biosample}", "Metrics", "QCPlots.pdf"), biosample=BIOSAMPLES_CONFIG["biosample"]
		)

